(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     59357,       1480]
NotebookOptionsPosition[     57493,       1427]
NotebookOutlinePosition[     57997,       1447]
CellTagsIndexPosition[     57954,       1444]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["An\[AAcute]lisis de duraci\[OAcute]n de los trends", "Title",
 CellChangeTimes->{{3.7033608464355783`*^9, 3.7033608502194366`*^9}, {
  3.7033742599336557`*^9, 
  3.703374264901923*^9}},ExpressionUUID->"e06dd222-b1a6-433d-8cec-\
826bfd9cd761"],

Cell[CellGroupData[{

Cell["Declaraci\[OAcute]n de funciones", "Chapter",
 CellChangeTimes->{{3.685988843800478*^9, 3.685988848754693*^9}, {
  3.70337426834956*^9, 
  3.703374273581751*^9}},ExpressionUUID->"6387856d-86d7-4526-8e8f-\
00dcc96e664d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TrendDuration", "[", 
    RowBox[{"timeseries_", ",", "dates_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns", ",", 
       "distance"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Primero", " ", "creo", " ", "una", " ", 
       RowBox[{"funci\[OAcute]n", " ", "'"}], 
       RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
       "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
       "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
       RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", " ",
        "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", " ", 
       "es", " ", "ascendente", " ", "o", " ", 
       RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"timeseries", ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sign", " ", "=", " ", 
       RowBox[{"Sign", "[", 
        RowBox[{
         RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"first", " ", "=", " ", 
       RowBox[{"timeseries", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"distance", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
         RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ", 
         "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", " ", 
         "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", " ", 
         "el", " ", "fin"}], ",", " ", 
        RowBox[{
        "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
         " ", "nueva", " ", 
         RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"distance", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", " ", "\[NotEqual]", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{"i", " ", "\[Equal]", " ", 
             RowBox[{
              RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"returns", ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"dates", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", "distance"}], "}"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"first", " ", "=", " ", 
             RowBox[{"timeseries", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sign", "  ", "=", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"distance", " ", "=", " ", "0"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "returns", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TrendDurationNoDates", "[", "timeseries_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns", ",", 
        "distance"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Primero", " ", "creo", " ", "una", " ", 
        RowBox[{"funci\[OAcute]n", " ", "'"}], 
        RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
        "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
        "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
        RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", 
        " ", "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", 
        " ", "es", " ", "ascendente", " ", "o", " ", 
        RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"timeseries", ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sign", " ", "=", " ", 
        RowBox[{"Sign", "[", 
         RowBox[{
          RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"first", " ", "=", " ", 
        RowBox[{"timeseries", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"returns", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"distance", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
          RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ",
           "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", 
          " ", "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", 
          " ", "el", " ", "fin"}], ",", " ", 
         RowBox[{
         "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
          " ", "nueva", " ", 
          RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"distance", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"sign", " ", "\[NotEqual]", " ", 
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{"f", "'"}], "[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
             RowBox[{"i", " ", "\[Equal]", " ", 
              RowBox[{
               RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"returns", ",", " ", "distance"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"first", " ", "=", " ", 
              RowBox[{"timeseries", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"sign", "  ", "=", " ", 
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{"f", "'"}], "[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"distance", " ", "=", " ", "0"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "returns", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ADPiValues", "[", 
    RowBox[{"data_", ",", "dates_", ",", " ", "window_"}], "]"}], ":=", " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"part", ",", " ", "cutdates", ",", "ad"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"part", " ", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{"data", ",", "window", ",", "1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cutdates", " ", "=", " ", 
       RowBox[{"dates", "[", 
        RowBox[{"[", 
         RowBox[{"window", ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ad", " ", "=", " ", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"cutdates", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"Quiet", "[", 
            RowBox[{"AndersonDarlingTest", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"part", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
              RowBox[{"GeometricDistribution", "[", "0.5", "]"}]}], "]"}], 
            "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "part", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "ad", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ADPiValuesNoDates", "[", 
     RowBox[{"data_", ",", " ", "window_"}], "]"}], ":=", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"part", ",", " ", "cutdates", ",", "ad"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"part", " ", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{"data", ",", "window", ",", "1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ad", " ", "=", " ", 
        RowBox[{"ParallelTable", "[", 
         RowBox[{
          RowBox[{"Quiet", "[", 
           RowBox[{"AndersonDarlingTest", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"part", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
             RowBox[{"GeometricDistribution", "[", "0.5", "]"}]}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "part", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "ad", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImportFinancialData", "[", "path_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "data", ",", " ", "years", ",", " ", "month", ",", " ", "day", ",", 
        " ", "price", ",", " ", "date"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"Import", "[", "path", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"years", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"month", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"day", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"price", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"date", " ", "=", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"years", ",", "month", ",", "day"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"date", ",", "price"}], "}"}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plotsdir", " ", "=", " ", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<Plots/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"samplesdir", " ", "=", " ", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<Samples/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"historicDataDir", " ", "=", " ", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
     "\"\<HistoricData/\>\""}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"DirectoryQ", "[", "plotsdir", " ", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"CreateDirectory", "[", "plotsdir", " ", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "historicDataDir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"historicfiles", " ", "=", " ", 
   RowBox[{"FileNames", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "samplesdir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"files", " ", "=", " ", 
   RowBox[{"FileNames", "[", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6967310587339573`*^9, 3.696731059048162*^9}, {
   3.6968167348832846`*^9, 3.696816747747058*^9}, {3.6968171278439016`*^9, 
   3.696817154918358*^9}, 3.7033608316871767`*^9, {3.7033702361576977`*^9, 
   3.703370258805093*^9}, {3.703370561648903*^9, 3.7033706562650137`*^9}, {
   3.703372932888672*^9, 
   3.7033729858572474`*^9}},ExpressionUUID->"2e63861a-6f76-4058-96ba-\
86fa1a530e1b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Gr\[AAcute]ficas de p-valores", "Chapter",
 CellChangeTimes->{{3.7033706059817457`*^9, 
  3.703370610357686*^9}},ExpressionUUID->"ca009c4c-3dc6-4557-b866-\
7161c92a3e8c"],

Cell["Equivalentes a la Fig. 4.", "Text",
 CellChangeTimes->{{3.6860006613678856`*^9, 
  3.6860006675454144`*^9}},ExpressionUUID->"5a2842c5-749d-4737-9d84-\
e09c52276ae0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", "historicDataDir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"filedata", " ", "=", " ", 
     RowBox[{"StringSplit", "[", 
      RowBox[{
       RowBox[{"FileBaseName", "[", "f", "]"}], ",", "\"\<_\>\""}], "]"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"marketname", " ", "=", " ", 
     RowBox[{"filedata", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"startdate", " ", "=", " ", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"filedata", "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"4", ",", "3", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], ";",
     "\[IndentingNewLine]", 
    RowBox[{"enddate", " ", "=", " ", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"filedata", "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"7", ",", "6", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], ";",
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"data", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Import", "[", 
        RowBox[{"historicDataDir", "<>", "f"}], "]"}], ",", "1"}], "]"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"prices", " ", "=", " ", "data"}], ";", "\[IndentingNewLine]", 
    RowBox[{"trendDuration", " ", "=", " ", 
     RowBox[{"TrendDurationNoDates", "[", "prices", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"ad", " ", "=", " ", 
     RowBox[{"ADPiValuesNoDates", "[", 
      RowBox[{"trendDuration", ",", "500"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"plot", " ", "=", " ", 
     RowBox[{"DateListLogPlot", "[", 
      RowBox[{"ad", ",", 
       RowBox[{"{", 
        RowBox[{"startdate", ",", "enddate"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", " ", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Year\>\"", ",", " ", "\"\<\[Pi]-Value\>\""}], "}"}]}], 
       ",", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"FontSize", "\[Rule]", "13"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"marketname", "<>", "\"\< \>\"", " ", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{"startdate", ",", "\"\<ISODate\>\""}], "]"}], "<>", 
         "\"\< - \>\"", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{"enddate", ",", "\"\<ISODate\>\""}], "]"}]}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "plotsdir", "<>", "\"\<pvalores_\>\"", "<>", "marketname", "<>", 
       "\"\<.png\>\""}], ",", "plot"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "plot", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", ",", 
   RowBox[{"{", 
    RowBox[{"f", ",", "historicfiles"}], "}"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.703370666077901*^9, 3.703370701296606*^9}, {
   3.703370836592833*^9, 3.7033709706733007`*^9}, {3.703371055107037*^9, 
   3.703371055329286*^9}, {3.7033713122744226`*^9, 3.7033713157590513`*^9}, 
   3.7033729394753637`*^9, {3.7033729966958227`*^9, 
   3.7033729973370333`*^9}},ExpressionUUID->"f064f29f-e205-49e3-b8fc-\
b20e77040a3d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Distribution", "Chapter",
 CellChangeTimes->{{3.685988873019004*^9, 3.685988875024443*^9}}],

Cell["Equivalentes a la Fig. 3.", "Text",
 CellChangeTimes->{{3.6860006811304336`*^9, 3.6860006871490917`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"UpwardTrendDuration", "[", 
    RowBox[{"timeseries_", ",", "dates_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns", ",", 
       "distance"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Primero", " ", "creo", " ", "una", " ", 
       RowBox[{"funci\[OAcute]n", " ", "'"}], 
       RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
       "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
       "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
       RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", " ",
        "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", " ", 
       "es", " ", "ascendente", " ", "o", " ", 
       RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"timeseries", ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sign", " ", "=", " ", 
       RowBox[{"Sign", "[", 
        RowBox[{
         RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"first", " ", "=", " ", 
       RowBox[{"timeseries", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"distance", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
         RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ", 
         "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", " ", 
         "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", " ", 
         "el", " ", "fin"}], ",", " ", 
        RowBox[{
        "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
         " ", "nueva", " ", 
         RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"distance", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", " ", "\[NotEqual]", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{"i", " ", "\[Equal]", " ", 
             RowBox[{
              RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"sign", " ", "\[Equal]", " ", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"returns", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"dates", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "distance"}], 
                  "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"first", " ", "=", " ", 
             RowBox[{"timeseries", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sign", "  ", "=", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"distance", " ", "=", " ", "0"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "returns", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DownwardTrendDuration", "[", 
    RowBox[{"timeseries_", ",", "dates_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns", ",", 
       "distance"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Primero", " ", "creo", " ", "una", " ", 
       RowBox[{"funci\[OAcute]n", " ", "'"}], 
       RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
       "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
       "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
       RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", " ",
        "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", " ", 
       "es", " ", "ascendente", " ", "o", " ", 
       RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"timeseries", ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sign", " ", "=", " ", 
       RowBox[{"Sign", "[", 
        RowBox[{
         RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"first", " ", "=", " ", 
       RowBox[{"timeseries", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"distance", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
         RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ", 
         "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", " ", 
         "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", " ", 
         "el", " ", "fin"}], ",", " ", 
        RowBox[{
        "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
         " ", "nueva", " ", 
         RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"distance", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", " ", "\[NotEqual]", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{"i", " ", "\[Equal]", " ", 
             RowBox[{
              RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"sign", " ", "\[Equal]", " ", 
               RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"returns", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"dates", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "distance"}], 
                  "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"first", " ", "=", " ", 
             RowBox[{"timeseries", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sign", "  ", "=", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"distance", " ", "=", " ", "0"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "returns", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6859917961891117`*^9, 3.6859918124634447`*^9}, {
  3.68599202728298*^9, 
  3.6859920351438923`*^9}},ExpressionUUID->"c08f9606-8d87-4f36-9123-\
a877633c7efd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", "samplesdir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"files", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<S&P 500.csv\>\"", ",", " ", "\"\<IPC.csv\>\"", ",", " ", 
      "\"\<NASDAQ Composite.csv\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"marketname", " ", "=", " ", 
     RowBox[{"FileBaseName", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"data", " ", "=", 
     RowBox[{"ImportFinancialData", "[", 
      RowBox[{"samplesdir", "<>", "f"}], "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"dates", " ", "=", " ", 
     RowBox[{"data", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"prices", " ", "=", " ", 
     RowBox[{"data", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"**", " ", "Upward"}], " ", "***)"}], "\[IndentingNewLine]", 
    RowBox[{"trendDuration", " ", "=", " ", 
     RowBox[{"UpwardTrendDuration", "[", 
      RowBox[{"prices", ",", " ", "dates"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"tddates", " ", "=", " ", 
     RowBox[{"trendDuration", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"tddata", " ", "=", " ", 
     RowBox[{
      RowBox[{"trendDuration", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Old", " ", "dates"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"window", " ", "=", " ", "1000"}], ";", "\[IndentingNewLine]", 
    RowBox[{"l", " ", "=", " ", 
     RowBox[{"HistogramList", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "window"}], "]"}], "]"}], ",", "Automatic", ",", 
       "\"\<Probability\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"pts", " ", "=", " ", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"l", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
        RowBox[{"l", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fit", " ", "=", " ", 
     RowBox[{"FindDistributionParameters", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "window"}], "]"}], "]"}], ",", 
       RowBox[{"GeometricDistribution", "[", "p", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fittedPts", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"PDF", "[", 
          RowBox[{
           RowBox[{"GeometricDistribution", "[", 
            RowBox[{"p", " ", "/.", " ", "fit"}], "]"}], ",", "k"}], "]"}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", 
         RowBox[{"Max", "[", 
          RowBox[{"pts", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
      "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"plot", " ", "=", " ", 
     RowBox[{"ListLogPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pts", ",", "fittedPts"}], "}"}], ",", 
       RowBox[{"Joined", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", "True"}], "}"}]}], ",", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Duration (Days)\>\"", ",", " ", "\"\<Probability\>\""}],
          "}"}]}], ",", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"FontSize", "\[Rule]", "14"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"marketname", "<>", "\"\< \>\"", " ", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<ISODate\>\""}], "]"}], 
         "<>", "\"\< - \>\"", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", "window", "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}]}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PointSize", "[", "Large", "]"}], ",", "Red"}], "}"}]}], 
       ",", 
       RowBox[{"PlotLegends", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Upward trend distribution\>\"", ",", " ", 
          "\"\<Geometric fit\>\""}], "}"}]}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Inset", "[", 
          RowBox[{
           RowBox[{"Framed", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<\!\(\*OverscriptBox[\(p\), \(^\)]\) = \>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"p", " ", "/.", " ", "fit"}], "]"}]}], ",", "14"}], 
               "]"}], "]"}], ",", 
             RowBox[{"RoundingRadius", "\[Rule]", "1"}], ",", 
             RowBox[{"Background", "\[Rule]", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"1", ",", "1", ",", "1", ",", ".8"}], "]"}]}]}], "]"}],
            ",", 
           RowBox[{"Scaled", "[", 
            RowBox[{"{", 
             RowBox[{"0.8", ",", ".8"}], "}"}], "]"}]}], "]"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "plotsdir", "<>", "\"\<dist_pos_olddates_\>\"", "<>", "marketname", 
       "<>", "\"\<.png\>\""}], ",", "plot"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "plot", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Recent", " ", "dates"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"l", " ", "=", " ", 
     RowBox[{"HistogramList", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", "window"}], ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "Automatic", ",", 
       "\"\<Probability\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"pts", " ", "=", " ", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"l", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
        RowBox[{"l", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fit", " ", "=", " ", 
     RowBox[{"FindDistributionParameters", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", "window"}], ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"GeometricDistribution", "[", "p", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fittedPts", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"PDF", "[", 
          RowBox[{
           RowBox[{"GeometricDistribution", "[", 
            RowBox[{"p", " ", "/.", " ", "fit"}], "]"}], ",", "k"}], "]"}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", 
         RowBox[{"Max", "[", 
          RowBox[{"pts", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
      "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"plot", " ", "=", " ", 
     RowBox[{"ListLogPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pts", ",", "fittedPts"}], "}"}], ",", 
       RowBox[{"Joined", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", "True"}], "}"}]}], ",", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Duration (Days)\>\"", ",", " ", "\"\<Probability\>\""}],
          "}"}]}], ",", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"FontSize", "\[Rule]", "14"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"marketname", "<>", "\"\< \>\"", " ", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", 
             RowBox[{"-", "window"}], "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}], "<>", "\"\< - \>\"", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}]}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PointSize", "[", "Large", "]"}], ",", "Red"}], "}"}]}], 
       ",", 
       RowBox[{"PlotLegends", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Upward trend distribution\>\"", ",", " ", 
          "\"\<Geometric fit\>\""}], "}"}]}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Inset", "[", 
          RowBox[{
           RowBox[{"Framed", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<\!\(\*OverscriptBox[\(p\), \(^\)]\) = \>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"p", " ", "/.", " ", "fit"}], "]"}]}], ",", "14"}], 
               "]"}], "]"}], ",", 
             RowBox[{"RoundingRadius", "\[Rule]", "1"}], ",", 
             RowBox[{"Background", "\[Rule]", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"1", ",", "1", ",", "1", ",", ".8"}], "]"}]}]}], "]"}],
            ",", 
           RowBox[{"Scaled", "[", 
            RowBox[{"{", 
             RowBox[{"0.8", ",", ".8"}], "}"}], "]"}]}], "]"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "plotsdir", "<>", "\"\<dist_pos_recentdates_\>\"", "<>", "marketname", 
       "<>", "\"\<.png\>\""}], ",", "plot"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "plot", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"**", " ", "Downward"}], " ", "***)"}], "\[IndentingNewLine]", 
    RowBox[{"trendDuration", " ", "=", 
     RowBox[{"DownwardTrendDuration", "[", 
      RowBox[{"prices", ",", " ", "dates"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"tddates", " ", "=", " ", 
     RowBox[{"trendDuration", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"tddata", " ", "=", " ", 
     RowBox[{
      RowBox[{"trendDuration", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Old", " ", "dates"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"l", " ", "=", " ", 
     RowBox[{"HistogramList", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "window"}], "]"}], "]"}], ",", "Automatic", ",", 
       "\"\<Probability\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"pts", " ", "=", " ", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"l", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
        RowBox[{"l", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fit", " ", "=", " ", 
     RowBox[{"FindDistributionParameters", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "window"}], "]"}], "]"}], ",", 
       RowBox[{"GeometricDistribution", "[", "p", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fittedPts", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"PDF", "[", 
          RowBox[{
           RowBox[{"GeometricDistribution", "[", 
            RowBox[{"p", " ", "/.", " ", "fit"}], "]"}], ",", "k"}], "]"}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", 
         RowBox[{"Max", "[", 
          RowBox[{"pts", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
      "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"plot", " ", "=", " ", 
     RowBox[{"ListLogPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pts", ",", "fittedPts"}], "}"}], ",", 
       RowBox[{"Joined", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", "True"}], "}"}]}], ",", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Duration (Days)\>\"", ",", " ", "\"\<Probability\>\""}],
          "}"}]}], ",", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"FontSize", "\[Rule]", "14"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"marketname", "<>", "\"\< \>\"", " ", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<ISODate\>\""}], "]"}], 
         "<>", "\"\< - \>\"", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", "window", "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}]}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PointSize", "[", "Large", "]"}], ",", "Blue"}], "}"}]}], 
       ",", 
       RowBox[{"PlotLegends", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Downward trend distribution\>\"", ",", " ", 
          "\"\<Geometric fit\>\""}], "}"}]}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Inset", "[", 
          RowBox[{
           RowBox[{"Framed", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<\!\(\*OverscriptBox[\(p\), \(^\)]\) = \>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"p", " ", "/.", " ", "fit"}], "]"}]}], ",", "14"}], 
               "]"}], "]"}], ",", 
             RowBox[{"RoundingRadius", "\[Rule]", "1"}], ",", 
             RowBox[{"Background", "\[Rule]", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"1", ",", "1", ",", "1", ",", ".8"}], "]"}]}]}], "]"}],
            ",", 
           RowBox[{"Scaled", "[", 
            RowBox[{"{", 
             RowBox[{"0.8", ",", ".8"}], "}"}], "]"}]}], "]"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "plotsdir", "<>", "\"\<dist_neg_olddates_\>\"", "<>", "marketname", 
       "<>", "\"\<.png\>\""}], ",", "plot"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "plot", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Recent", " ", "dates"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"l", " ", "=", " ", 
     RowBox[{"HistogramList", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", "window"}], ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "Automatic", ",", 
       "\"\<Probability\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"pts", " ", "=", " ", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"l", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
        RowBox[{"l", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fit", " ", "=", " ", 
     RowBox[{"FindDistributionParameters", "[", 
      RowBox[{
       RowBox[{"tddata", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", "window"}], ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"GeometricDistribution", "[", "p", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"fittedPts", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"PDF", "[", 
          RowBox[{
           RowBox[{"GeometricDistribution", "[", 
            RowBox[{"p", " ", "/.", " ", "fit"}], "]"}], ",", "k"}], "]"}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", 
         RowBox[{"Max", "[", 
          RowBox[{"pts", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"plot", " ", "=", " ", 
     RowBox[{"ListLogPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pts", ",", "fittedPts"}], "}"}], ",", 
       RowBox[{"Joined", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", "True"}], "}"}]}], ",", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Duration (Days)\>\"", ",", " ", "\"\<Probability\>\""}],
          "}"}]}], ",", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"FontSize", "\[Rule]", "14"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"marketname", "<>", "\"\< \>\"", " ", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", 
             RowBox[{"-", "window"}], "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}], "<>", "\"\< - \>\"", "<>", 
         RowBox[{"DateString", "[", 
          RowBox[{
           RowBox[{"tddates", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<ISODate\>\""}], 
          "]"}]}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PointSize", "[", "Large", "]"}], ",", "Blue"}], "}"}]}], 
       ",", 
       RowBox[{"PlotLegends", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Downward trend distribution\>\"", ",", " ", 
          "\"\<Geometric fit\>\""}], "}"}]}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Inset", "[", 
          RowBox[{
           RowBox[{"Framed", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<\!\(\*OverscriptBox[\(p\), \(^\)]\) = \>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"p", " ", "/.", " ", "fit"}], "]"}]}], ",", "14"}], 
               "]"}], "]"}], ",", 
             RowBox[{"RoundingRadius", "\[Rule]", "1"}], ",", 
             RowBox[{"Background", "\[Rule]", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"1", ",", "1", ",", "1", ",", ".8"}], "]"}]}]}], "]"}],
            ",", 
           RowBox[{"Scaled", "[", 
            RowBox[{"{", 
             RowBox[{"0.8", ",", ".8"}], "}"}], "]"}]}], "]"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "plotsdir", "<>", "\"\<dist_neg_recentdates_\>\"", "<>", "marketname", 
       "<>", "\"\<.png\>\""}], ",", "plot"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "plot", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", ",", 
   RowBox[{"{", 
    RowBox[{"f", ",", "files"}], "}"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.703373781413278*^9, 3.703373835744974*^9}, {
  3.703374108754353*^9, 
  3.7033741261040497`*^9}},ExpressionUUID->"9e8173e6-c762-4b55-a1c5-\
bc7f577a4cc5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Trend signs", "Chapter",
 CellChangeTimes->{{3.685995960074155*^9, 3.6859959677580757`*^9}}],

Cell["Equivalentes a la Fig. 2.", "Text",
 CellChangeTimes->{{3.6860007198502235`*^9, 3.686000725797335*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TrendReturns", "[", "timeseries_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "prices", ",", " ", "dates", ",", " ", "f", ",", " ", "sign", ",", " ",
         "first", ",", " ", "returns"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dates", " ", "=", " ", 
        RowBox[{"timeseries", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"prices", " ", "=", " ", 
        RowBox[{"timeseries", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"prices", ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sign", " ", "=", " ", 
        RowBox[{"Sign", "[", 
         RowBox[{
          RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"first", " ", "=", " ", 
        RowBox[{"prices", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"returns", " ", "=", " ", 
        RowBox[{
         RowBox[{"Reap", "[", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"sign", " ", "\[NotEqual]", " ", 
                 RowBox[{"Sign", "[", 
                  RowBox[{
                   RowBox[{"f", "'"}], "[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
                RowBox[{"i", " ", "\[Equal]", " ", 
                 RowBox[{
                  RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Sow", "[", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"dates", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"Log", "[", 
                    RowBox[{"prices", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", 
                    RowBox[{"Log", "[", "first", "]"}]}]}], "}"}], "]"}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"first", " ", "=", " ", 
                 RowBox[{"prices", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"sign", "  ", "=", " ", 
                 RowBox[{"Sign", "[", 
                  RowBox[{
                   RowBox[{"f", "'"}], "[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], 
             "}"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
          "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "returns", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SignRatio", "[", 
     RowBox[{"data_", ",", " ", "window_"}], "]"}], ":=", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"part", ",", " ", "sr"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"part", " ", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{"data", ",", "window", ",", "1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sr", " ", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"part", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", 
               RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], ",", 
            FractionBox[
             RowBox[{"Total", "[", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"part", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"#", ">", "0"}], "&"}]}], "]"}], "]"}], 
             RowBox[{"Total", "[", 
              RowBox[{"Abs", "[", 
               RowBox[{"part", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], 
              "]"}]]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "part", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "sr", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "samplesdir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"files", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<S&P 500.csv\>\"", ",", " ", "\"\<IPC.csv\>\"", ",", " ", 
      "\"\<NASDAQ Composite.csv\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"window", " ", "=", " ", "1000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ratios", " ", "=", " ", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"marketname", " ", "=", " ", 
        RowBox[{"FileBaseName", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"data", " ", "=", 
        RowBox[{"ImportFinancialData", "[", 
         RowBox[{"samplesdir", "<>", "f"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"trendreturns", " ", "=", " ", 
        RowBox[{"TrendReturns", "[", "data", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"SignRatio", "[", 
        RowBox[{"trendreturns", ",", "window"}], "]"}]}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"f", ",", "files"}], "}"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plot", " ", "=", " ", 
   RowBox[{"DateListPlot", "[", 
    RowBox[{"ratios", ",", " ", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"FileBaseName", " ", "/@", " ", "files"}]}], ",", " ", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", " ", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<Date\>\"", ",", " ", "\"\<Ratio\>\""}], "}"}]}], ",", " ", 
     RowBox[{"BaseStyle", "\[Rule]", 
      RowBox[{"FontSize", "\[Rule]", "14"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"plotsdir", "<>", "\"\<sign_ratios.png\>\""}], ",", "plot"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "plot", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.703375412888665*^9, 
  3.7033754444625807`*^9}},ExpressionUUID->"4cc15487-8b4f-4ddf-9bbb-\
7c1ba40f8530"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1431, 866},
WindowMargins->{{Automatic, 169}, {Automatic, 4}},
PrintingCopies->1,
PrintingPageRange->{32000, 32000},
PrintingOptions->{"Magnification"->1.,
"PaperOrientation"->"Portrait",
"PaperSize"->{595.3199999999999, 841.92}},
FrontEndVersion->"11.1 for Linux x86 (64-bit) (April 18, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 248, 4, 93, "Title", "ExpressionUUID" -> \
"e06dd222-b1a6-433d-8cec-826bfd9cd761"],
Cell[CellGroupData[{
Cell[853, 30, 225, 4, 66, "Chapter", "ExpressionUUID" -> \
"6387856d-86d7-4526-8e8f-00dcc96e664d"],
Cell[1081, 36, 14356, 342, 1909, "Input", "ExpressionUUID" -> \
"2e63861a-6f76-4058-96ba-86fa1a530e1b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15474, 383, 176, 3, 66, "Chapter", "ExpressionUUID" -> \
"ca009c4c-3dc6-4557-b866-7161c92a3e8c"],
Cell[15653, 388, 171, 3, 31, "Text", "ExpressionUUID" -> \
"5a2842c5-749d-4737-9d84-e09c52276ae0"],
Cell[15827, 393, 3441, 80, 439, "Input", "ExpressionUUID" -> \
"f064f29f-e205-49e3-b8fc-b20e77040a3d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19305, 478, 97, 1, 66, "Chapter", "ExpressionUUID" -> \
"2f212519-b07f-4bdf-a247-dc166d9f72f5"],
Cell[19405, 481, 111, 1, 31, "Text", "ExpressionUUID" -> \
"af78210b-cd76-4527-bc8e-24227d72616a"],
Cell[19519, 484, 8979, 198, 1170, "Input", "ExpressionUUID" -> \
"c08f9606-8d87-4f36-9123-a877633c7efd"],
Cell[28501, 684, 21170, 541, 1860, "Input", "ExpressionUUID" -> \
"9e8173e6-c762-4b55-a1c5-bc7f577a4cc5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49708, 1230, 98, 1, 66, "Chapter", "ExpressionUUID" -> \
"c3d479e7-4227-4ebe-88a3-a1385418600a"],
Cell[49809, 1233, 109, 1, 31, "Text", "ExpressionUUID" -> \
"ae79ad9f-8c71-4e00-9a52-6a8180fbf096"],
Cell[49921, 1236, 7544, 187, 1053, "Input", "ExpressionUUID" -> \
"4cc15487-8b4f-4ddf-9bbb-7c1ba40f8530"]
}, Open  ]]
}, Open  ]]
}
]
*)

