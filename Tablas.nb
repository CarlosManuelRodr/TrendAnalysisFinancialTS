(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     47679,       1232]
NotebookOptionsPosition[     46674,       1193]
NotebookOutlinePosition[     47021,       1208]
CellTagsIndexPosition[     46978,       1205]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Tablas", "Title",
 CellChangeTimes->{{3.6941112917109165`*^9, 3.6941112924332047`*^9}}],

Cell[CellGroupData[{

Cell["Autor: Carlos Manuel Rodr\[IAcute]guez Mart\[IAcute]nez", "Subsection",
 CellChangeTimes->{{3.6942086945007954`*^9, 3.694208701349347*^9}}],

Cell["C\[OAcute]digo a partir del cual se generaron las tablas.", "Text",
 CellChangeTimes->{{3.694208677604724*^9, 3.6942086923009815`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Ley de potencias", "Chapter",
 CellChangeTimes->{{3.694111295461882*^9, 3.6941113012684345`*^9}}],

Cell["\<\
C\[OAcute]digo para separar la cola de la distribuci\[OAcute]n y realizar un \
ajuste de ley de potencias para la muestra procedente de la cola y \
as\[IAcute] poder calcular el p-valor. Se requiere primero haber generado la \
muestra utilizando el archivo \[OpenCurlyDoubleQuote]GeneradorMuestras.nb\
\[CloseCurlyDoubleQuote].\
\>", "Text",
 CellChangeTimes->{{3.694208647581328*^9, 3.6942086737324414`*^9}, {
  3.6942089125246315`*^9, 3.694208943893573*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AndersonDarling", "[", 
    RowBox[{"data_", ",", "\[Gamma]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s", ",", " ", "n", ",", "\[Alpha]", ",", "z", ",", "A2"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"s", " ", "=", " ", 
       RowBox[{"Sort", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Count", "[", 
        RowBox[{"s", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{"x", "\[GreaterEqual]", "\[Gamma]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", ">", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"s", " ", "=", " ", 
          RowBox[{"s", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"-", "n"}], ";;", 
             RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Alpha]", " ", "=", " ", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             FractionBox["1", "n"], " ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"Log", "[", 
                FractionBox[
                 RowBox[{"s", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "\[Gamma]"], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ")"}], 
           RowBox[{"-", "1"}]]}], ";", "\[IndentingNewLine]", 
         RowBox[{"z", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"1", "-", 
             SuperscriptBox[
              RowBox[{"(", 
               FractionBox["\[Gamma]", 
                RowBox[{"s", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]], ")"}], "\[Alpha]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"A2", " ", "=", " ", 
          RowBox[{
           RowBox[{"-", "n"}], "-", 
           RowBox[{
            FractionBox["1", "n"], 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", "i"}], "-", "1"}], ")"}], 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Log", "[", 
                  RowBox[{"z", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}], "+", 
                 RowBox[{"Log", "[", 
                  RowBox[{"1", "-", 
                   RowBox[{"z", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "-", "i", "+", "1"}], "]"}], "]"}]}], 
                  "]"}]}], ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}]}], ";", 
         " ", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "A2", "]"}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Return", "[", "\[Infinity]", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeftCutoff", "[", 
    RowBox[{
    "data_", ",", "\[Gamma]min_", ",", "\[Gamma]max_", ",", "d\[Gamma]_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tbl", ",", "minPos"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tbl", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Gamma]", ",", 
           RowBox[{"AndersonDarling", "[", 
            RowBox[{"data", ",", "\[Gamma]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "\[Gamma]", ",", "\[Gamma]min", ",", "\[Gamma]max", ",", 
           "d\[Gamma]"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tbl", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"tbl", ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", "\[Infinity]"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"minPos", " ", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"tbl", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"Min", "[", 
           RowBox[{"tbl", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"tbl", "[", 
        RowBox[{"[", 
         RowBox[{"minPos", ",", "1"}], "]"}], "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExPValue", "[", 
     RowBox[{
     "data_", ",", "\[Gamma]min_", ",", "\[Gamma]max_", ",", "d\[Gamma]_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "l", ",", "pts", ",", "model", ",", "fit", ",", "leftcutoff", ",", " ",
         "rightcutoff", ",", "pltmin", ",", "pltmax", ",", "k", ",", 
        "\[Alpha]", ",", " ", "datatofit", ",", "fitpts", ",", "param"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pltmin", " ", "=", " ", 
        RowBox[{"Min", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pltmax", " ", "=", " ", 
        RowBox[{"Max", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"leftcutoff", " ", "=", " ", 
        RowBox[{"LeftCutoff", "[", 
         RowBox[{
         "data", ",", "\[Gamma]min", ",", "\[Gamma]max", ",", "d\[Gamma]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"l", " ", "=", " ", 
        RowBox[{"HistogramList", "[", 
         RowBox[{"data", ",", "Automatic", ",", "\"\<PDF\>\""}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"pts", " ", "=", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"l", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
           RowBox[{"l", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"fitpts", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"data", ",", " ", 
          RowBox[{
           RowBox[{"#", ">", "leftcutoff"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"param", " ", "=", " ", 
        RowBox[{"FindDistributionParameters", "[", 
         RowBox[{"fitpts", ",", " ", 
          RowBox[{"ParetoDistribution", "[", 
           RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"DistributionFitTest", "[", 
         RowBox[{"fitpts", ",", " ", 
          RowBox[{
           RowBox[{"ParetoDistribution", "[", 
            RowBox[{"k", ",", "\[Alpha]"}], "]"}], "/.", "\[VeryThinSpace]", 
           "param"}]}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImportFinancialData", "[", "path_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "data", ",", " ", "years", ",", " ", "month", ",", " ", "day", ",", 
        " ", "price", ",", " ", "date"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"Import", "[", "path", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"years", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"month", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"day", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"price", " ", "=", " ", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"date", " ", "=", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"years", ",", "month", ",", "day"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"date", ",", "price"}], "}"}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TrendReturns", "[", "timeseries_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Primero", " ", "creo", " ", "una", " ", 
       RowBox[{"funci\[OAcute]n", " ", "'"}], 
       RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
       "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
       "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
       RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", " ",
        "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", " ", 
       "es", " ", "ascendente", " ", "o", " ", 
       RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"timeseries", ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sign", " ", "=", " ", 
       RowBox[{"Sign", "[", 
        RowBox[{
         RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"first", " ", "=", " ", 
       RowBox[{"timeseries", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
         RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ", 
         "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", " ", 
         "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", " ", 
         "el", " ", "fin"}], ",", " ", 
        RowBox[{
        "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
         " ", "nueva", " ", 
         RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", " ", "\[NotEqual]", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{"i", " ", "\[Equal]", " ", 
             RowBox[{
              RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"returns", ",", " ", 
              RowBox[{
               RowBox[{"Log", "[", 
                RowBox[{"timeseries", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", 
               RowBox[{"Log", "[", "first", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"first", " ", "=", " ", 
             RowBox[{"timeseries", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sign", "  ", "=", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "returns", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetPValues", "[", "file_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"data", ",", "trendreturns", ",", "posData", ",", "negData"}], 
       "}"}], ",", "\[IndentingNewLine]", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Cargo", " ", "los", " ", "datos", " ", "del", " ", "mercado", " ", 
        "desde", " ", "el", " ", "1", " ", "de", " ", "enero", " ", "de", " ",
         "2013."}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"ImportFinancialData", "[", "file", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"trendreturns", " ", "=", "  ", 
        RowBox[{"TrendReturns", "[", 
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"posData", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"trendreturns", " ", ",", 
          RowBox[{
           RowBox[{"#", ">", "0"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"negData", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{"Select", "[", 
          RowBox[{"trendreturns", " ", ",", 
           RowBox[{
            RowBox[{"#", "<", "0"}], "&"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ExPValue", "[", 
           RowBox[{"posData", ",", " ", "0.0001", ",", 
            RowBox[{"Max", "[", "posData", "]"}], ",", "0.00001"}], "]"}], 
          ",", 
          RowBox[{"ExPValue", "[", 
           RowBox[{"negData", ",", " ", "0.0001", ",", 
            RowBox[{"Max", "[", "negData", "]"}], ",", "0.00001"}], "]"}]}], 
         "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Retornos", " ", "simples"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Returns", "[", 
    RowBox[{"x_", ",", "lag_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"Log", "[", 
     RowBox[{"x", "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", 
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"1", "+", "lag"}], ")"}]}]}], "]"}], "]"}], "]"}], "-", 
    RowBox[{"Log", "[", 
     RowBox[{"x", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", "lag"}], ")"}], ";;", 
        RowBox[{"-", "1"}]}], "]"}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetPValuesSimpleRet", "[", "file_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", ",", "returns", ",", "posData", ",", "negData"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"ImportFinancialData", "[", "file", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", "  ", 
       RowBox[{"Returns", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posData", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"returns", " ", ",", 
         RowBox[{
          RowBox[{"#", ">", "0"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"negData", " ", "=", " ", 
       RowBox[{"-", 
        RowBox[{"Select", "[", 
         RowBox[{"returns", " ", ",", 
          RowBox[{
           RowBox[{"#", "<", "0"}], "&"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ExPValue", "[", 
          RowBox[{"posData", ",", " ", "0.0001", ",", 
           RowBox[{"Max", "[", "posData", "]"}], ",", "0.0001"}], "]"}], ",", 
         RowBox[{"ExPValue", "[", 
          RowBox[{"negData", ",", " ", "0.0001", ",", 
           RowBox[{"Max", "[", "negData", "]"}], ",", "0.0001"}], "]"}]}], 
        "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.694111287776894*^9, 3.6941112881249456`*^9}, {
  3.694122143879365*^9, 3.694122180999318*^9}, {3.694122303079032*^9, 
  3.6941223056624484`*^9}, {3.6941224248392243`*^9, 3.694122425871279*^9}, {
  3.6942088360416837`*^9, 3.694208839466707*^9}}],

Cell[CellGroupData[{

Cell["Trend Returns", "Subsection",
 CellChangeTimes->{{3.69412218432996*^9, 3.6941221884576187`*^9}}],

Cell["Tabla utilizando retornos de los trends.", "Text",
 CellChangeTimes->{{3.6942087124614944`*^9, 3.6942087208202996`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Esta", " ", "es", " ", "una", " ", "lista", " ", "con", " ", "los", " ", 
     "mercados", " ", "que", " ", "voy", " ", "a", " ", 
     RowBox[{"usar", ".", " ", "Primero"}], " ", "escribo", " ", "el", " ", 
     "nombre", " ", "que", " ", "quiero", " ", "que", " ", "salga", " ", "en",
      " ", "la", " ", "gr\[AAcute]fica"}], ",", " ", 
    RowBox[{"y", " ", "luego", " ", "el", " ", 
     RowBox[{"mercado", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"markets", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<S&P 500\>\"", ",", "\"\<sAndP.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<NASDAQ Composite\>\"", ",", " ", "\"\<nasdaq.csv\>\""}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<IPC\>\"", ",", "\"\<ipc.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Footsie 100\>\"", ",", "\"\<ftse.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Hang Seng\>\"", ",", " ", "\"\<hsi.csv\>\""}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"\"\<NYSE Composite\>\"", ",", "\"\<nya.csv\>\""}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"\"\<CAC 40\>\"", ",", " ", "\"\<fchi.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<DAX\>\"", ",", "\"\<gdaxi.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<MERVAL\>\"", ",", "\"\<merv.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<FTSE Malasya\>\"", ",", "\"\<klse.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<TA-100\>\"", ",", "\"\<ta100.csv\>\""}], "}"}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"path", " ", "=", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pvalues", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"GetPValues", "[", 
        RowBox[{"path", "<>", 
         RowBox[{"i", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "markets"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Grid", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "\"\<Mercado\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"markets", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"{", "\"\<Cola positiva\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"pvalues", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"{", "\"\<Cola negativa\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"pvalues", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
     RowBox[{"Spacings", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "All"}], ",", 
     RowBox[{"ItemStyle", "\[Rule]", "\"\<Text\>\""}], ",", 
     RowBox[{"Background", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Gray", ",", "None"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"LightGray", ",", "None"}], "}"}]}], "}"}]}]}], 
    "]"}]}]}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simple ret", "Subsection",
 CellChangeTimes->{{3.694122191641088*^9, 3.6941221928571987`*^9}}],

Cell["Tabla utilizando retornos simples.", "Text",
 CellChangeTimes->{{3.694208724348068*^9, 3.694208729844496*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Esta", " ", "es", " ", "una", " ", "lista", " ", "con", " ", "los", " ", 
     "mercados", " ", "que", " ", "voy", " ", "a", " ", 
     RowBox[{"usar", ".", " ", "Primero"}], " ", "escribo", " ", "el", " ", 
     "nombre", " ", "que", " ", "quiero", " ", "que", " ", "salga", " ", "en",
      " ", "la", " ", "gr\[AAcute]fica"}], ",", " ", 
    RowBox[{"y", " ", "luego", " ", "el", " ", 
     RowBox[{"mercado", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"markets", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<S&P 500\>\"", ",", "\"\<sAndP.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<NASDAQ Composite\>\"", ",", " ", "\"\<nasdaq.csv\>\""}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<IPC\>\"", ",", "\"\<ipc.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Footsie 100\>\"", ",", "\"\<ftse.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Hang Seng\>\"", ",", " ", "\"\<hsi.csv\>\""}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"\"\<NYSE Composite\>\"", ",", "\"\<nya.csv\>\""}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"\"\<CAC 40\>\"", ",", " ", "\"\<fchi.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<DAX\>\"", ",", "\"\<gdaxi.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<MERVAL\>\"", ",", "\"\<merv.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<FTSE Malasya\>\"", ",", "\"\<klse.csv\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<TA-100\>\"", ",", "\"\<ta100.csv\>\""}], "}"}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"path", " ", "=", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pvalues", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"GetPValuesSimpleRet", "[", 
        RowBox[{"path", "<>", 
         RowBox[{"i", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "markets"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Grid", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "\"\<Mercado\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"markets", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"{", "\"\<Cola positiva\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"pvalues", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"{", "\"\<Cola negativa\>\"", "}"}], "~", "Join", "~", 
        RowBox[{"pvalues", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
     RowBox[{"Spacings", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "All"}], ",", 
     RowBox[{"ItemStyle", "\[Rule]", "\"\<Text\>\""}], ",", 
     RowBox[{"Background", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Gray", ",", "None"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"LightGray", ",", "None"}], "}"}]}], "}"}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.69412220129089*^9, {3.6941222356035905`*^9, 3.6941222409235044`*^9}, {
   3.6941224613065953`*^9, 3.69412246679459*^9}, {3.6942089016771107`*^9, 
   3.6942089020395637`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simetr\[IAcute]a", "Chapter",
 CellChangeTimes->{{3.6941113057072973`*^9, 3.694111307593612*^9}}],

Cell["\<\
C\[OAcute]digo para generar una tabla donde se muestran los resultados del \
test de simetr\[IAcute]a.\
\>", "Text",
 CellChangeTimes->{{3.694208736396305*^9, 3.6942087543005443`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"executable", " ", "=", " ", "\"\<TnStatisticMathLink.exe\>\""}], 
  ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "En", " ", "Linux", " ", "o", " ", "OSX", " ", "usar", " ", 
    "TnStatisticMathLink"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"link", " ", "=", " ", 
   RowBox[{"Install", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], "<>", "executable"}], " ", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tn", "[", 
    RowBox[{"v_IntegerList", ",", " ", "c_"}], "]"}], ":=", " ", 
   RowBox[{"Tn", "[", 
    RowBox[{
     RowBox[{"N", "[", "v", "]"}], ",", "c"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tn", "[", 
    RowBox[{"v_IntegerList", ",", " ", "c_Integer"}], "]"}], ":=", " ", 
   RowBox[{"Tn", "[", 
    RowBox[{
     RowBox[{"N", "[", "v", "]"}], ",", 
     RowBox[{"N", "[", "c", "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tn", "[", 
    RowBox[{"v_Real64List", ",", " ", "c_Integer"}], "]"}], ":=", " ", 
   RowBox[{"Tn", "[", 
    RowBox[{"v", ",", 
     RowBox[{"N", "[", "c", "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Tn", "[", "v_", "]"}], ":=", " ", 
    RowBox[{"Tn", "[", 
     RowBox[{"v", ",", " ", "0.0"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cmin", " ", "=", " ", 
   RowBox[{"-", "0.001"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cmax", " ", "=", " ", "0.003"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[CapitalDelta]c", " ", "=", " ", "0.000005"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]s", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "0.001", ",", "0.005", ",", "0.01", ",", "0.025", ",", "0.05", ",", "0.1",
      ",", "0.15", ",", "0.25", ",", "0.5"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qs", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "7.803", ",", "5.768", ",", "4.909", ",", "3.798", ",", "2.983", ",", 
     "2.200", ",", "1.768", ",", "1.258", ",", "0.659"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]q", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]s", ",", "qs"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"upp", " ", "=", " ", 
    RowBox[{"Interpolation", "[", "\[Alpha]q", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TrendReturns", "[", "timeseries_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Primero", " ", "creo", " ", "una", " ", 
       RowBox[{"funci\[OAcute]n", " ", "'"}], 
       RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
       "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
       "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
       RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", " ",
        "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", " ", 
       "es", " ", "ascendente", " ", "o", " ", 
       RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"timeseries", ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sign", " ", "=", " ", 
       RowBox[{"Sign", "[", 
        RowBox[{
         RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"first", " ", "=", " ", 
       RowBox[{"timeseries", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"returns", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
         RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ", 
         "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", " ", 
         "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", " ", 
         "el", " ", "fin"}], ",", " ", 
        RowBox[{
        "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
         " ", "nueva", " ", 
         RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", " ", "\[NotEqual]", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{"i", " ", "\[Equal]", " ", 
             RowBox[{
              RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"returns", ",", " ", 
              RowBox[{
               RowBox[{"Log", "[", 
                RowBox[{"timeseries", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", 
               RowBox[{"Log", "[", "first", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"first", " ", "=", " ", 
             RowBox[{"timeseries", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sign", "  ", "=", " ", 
             RowBox[{"Sign", "[", 
              RowBox[{
               RowBox[{"f", "'"}], "[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "returns", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"VelocityTrendReturns", "[", "timeseries_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", " ", "sign", ",", " ", "first", ",", " ", "returns", ",", 
        "distance"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Primero", " ", "creo", " ", "una", " ", 
        RowBox[{"funci\[OAcute]n", " ", "'"}], 
        RowBox[{"f", "'"}], " ", "que", " ", "interpola", " ", "los", " ", 
        "datos", " ", "con", " ", "orden", " ", "1", " ", "para", " ", 
        "obtener", " ", "el", " ", "signo", " ", "de", " ", "su", " ", 
        RowBox[{"derivada", ".", " ", "Esto"}], " ", "lo", " ", "utilizo", 
        " ", "para", " ", "saber", " ", "si", " ", "la", " ", "tendencia", 
        " ", "es", " ", "ascendente", " ", "o", " ", 
        RowBox[{"descendente", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"timeseries", ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sign", " ", "=", " ", 
        RowBox[{"Sign", "[", 
         RowBox[{
          RowBox[{"f", "'"}], "[", "1", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"first", " ", "=", " ", 
        RowBox[{"timeseries", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"returns", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"distance", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Recorro", " ", "la", " ", "lista", " ", "de", " ", 
          RowBox[{"datos", ".", " ", "Si"}], " ", "la", " ", "tendencia", " ",
           "cambia", " ", "guardo", " ", "la", " ", "resta", " ", "entre", 
          " ", "el", " ", "inicio", " ", "de", " ", "tendencia", " ", "y", 
          " ", "el", " ", "fin"}], ",", " ", 
         RowBox[{
         "y", " ", "cambio", " ", "el", " ", "signo", " ", "de", " ", "la", 
          " ", "nueva", " ", 
          RowBox[{"tendencia", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"distance", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"sign", " ", "\[NotEqual]", " ", 
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{"f", "'"}], "[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}], " ", "||", " ", 
             RowBox[{"i", " ", "\[Equal]", " ", 
              RowBox[{
               RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"returns", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Log", "[", 
                   RowBox[{"timeseries", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", 
                  RowBox[{"Log", "[", "first", "]"}]}], ")"}], "/", 
                "distance"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"first", " ", "=", " ", 
              RowBox[{"timeseries", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"sign", "  ", "=", " ", 
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{"f", "'"}], "[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"distance", " ", "=", " ", "0"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"Length", "[", "timeseries", "]"}], "-", "1"}]}], "}"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "returns", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Retornos", " ", "simples"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Returns", "[", 
    RowBox[{"x_", ",", "lag_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"Log", "[", 
     RowBox[{"x", "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", 
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"1", "+", "lag"}], ")"}]}]}], "]"}], "]"}], "]"}], "-", 
    RowBox[{"Log", "[", 
     RowBox[{"x", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", "lag"}], ")"}], ";;", 
        RowBox[{"-", "1"}]}], "]"}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CL", " ", "=", " ", "0.05"}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Intervalo", " ", "de", " ", "confianza"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MeasureSymmetrySimpleRet", "[", "file_", "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"data", ",", " ", "returns"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"ImportFinancialData", "[", "file", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"returns", " ", "=", "  ", 
        RowBox[{"Returns", "[", 
         RowBox[{
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Tn", "[", 
           RowBox[{"trendreturns", ",", "0.0"}], "]"}], " ", "\[LessEqual]", 
          " ", 
          RowBox[{"upp", "[", "CL", "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "\"\<Sim\[EAcute]trico\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "\"\<Asim\[EAcute]trico\>\"", "]"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MeasureSymmetryRT", "[", "file_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", ",", "trendreturns"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"ImportFinancialData", "[", "file", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trendreturns", " ", "=", "  ", 
       RowBox[{"TrendReturns", "[", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Tn", "[", 
          RowBox[{"trendreturns", ",", "0.0"}], "]"}], " ", "\[LessEqual]", 
         " ", 
         RowBox[{"upp", "[", "CL", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "\"\<Sim\[EAcute]trico\>\"", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "\"\<Asim\[EAcute]trico\>\"", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MeasureSymmetryVRT", "[", "file_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"data", ",", "trendreturns"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"ImportFinancialData", "[", "file", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"trendreturns", " ", "=", "  ", 
        RowBox[{"VelocityTrendReturns", "[", 
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Tn", "[", 
           RowBox[{"trendreturns", ",", "0.0"}], "]"}], " ", "\[LessEqual]", 
          " ", 
          RowBox[{"upp", "[", "CL", "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "\"\<Sim\[EAcute]trico\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "\"\<Asim\[EAcute]trico\>\"", "]"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"markets", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<S&P 500\>\"", ",", "\"\<sAndP.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<NASDAQ Composite\>\"", ",", " ", "\"\<nasdaq.csv\>\""}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<IPC\>\"", ",", "\"\<ipc.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Footsie 100\>\"", ",", "\"\<ftse.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Hang Seng\>\"", ",", " ", "\"\<hsi.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<NYSE Composite\>\"", ",", "\"\<nya.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<CAC 40\>\"", ",", " ", "\"\<fchi.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<DAX\>\"", ",", "\"\<gdaxi.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<MERVAL\>\"", ",", "\"\<merv.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<FTSE Malasya\>\"", ",", "\"\<klse.csv\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<TA-100\>\"", ",", "\"\<ta100.csv\>\""}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"path", " ", "=", " ", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"simetriasimpleret", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"MeasureSymmetrySimpleRet", "[", 
      RowBox[{"path", "<>", 
       RowBox[{"i", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "markets"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"simetriart", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"MeasureSymmetryRT", "[", 
      RowBox[{"path", "<>", 
       RowBox[{"i", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "markets"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"simetriavrt", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"MeasureSymmetryVRT", "[", 
       RowBox[{"path", "<>", 
        RowBox[{"i", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "markets"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Grid", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"{", "\"\<Mercado\>\"", "}"}], "~", "Join", "~", 
      RowBox[{"markets", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"{", "\"\<R\>\"", "}"}], "~", "Join", "~", 
      "simetriasimpleret"}], ",", 
     RowBox[{
      RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(R\), \(T\)]\)\>\"", "}"}], "~", 
      "Join", "~", "simetriart"}], ",", 
     RowBox[{
      RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(VR\), \(T\)]\)\>\"", "}"}], "~", 
      "Join", "~", "simetriavrt"}]}], "}"}], ",", 
   RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
   RowBox[{"Spacings", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", "1"}], "}"}]}], ",", 
   RowBox[{"Frame", "\[Rule]", "All"}], ",", 
   RowBox[{"ItemStyle", "\[Rule]", "\"\<Text\>\""}], ",", 
   RowBox[{"Background", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Gray", ",", "None"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"LightGray", ",", "None"}], "}"}]}], "}"}]}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.694111356697733*^9, 3.694111472722396*^9}, {
   3.6941115091518607`*^9, 3.6941115632111797`*^9}, {3.694111606871876*^9, 
   3.694111637163224*^9}, {3.6941119510748982`*^9, 3.6941119532770033`*^9}, {
   3.694112646793638*^9, 3.6941126480667048`*^9}, {3.6941217496218777`*^9, 
   3.6941217822458057`*^9}, {3.694121819718238*^9, 3.6941218534940867`*^9}, {
   3.6941218837178793`*^9, 3.6941219260074263`*^9}, {3.694122000921977*^9, 
   3.6941220135821943`*^9}, 3.694122064436817*^9, {3.6942087598588333`*^9, 
   3.6942088909954104`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1904, 997},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 para Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 93, 1, 91, "Title"],
Cell[CellGroupData[{
Cell[698, 27, 145, 1, 43, "Subsection"],
Cell[846, 30, 141, 1, 30, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1024, 36, 103, 1, 65, "Chapter"],
Cell[1130, 39, 470, 8, 30, "Text"],
Cell[1603, 49, 17519, 441, 2441, "Input"],
Cell[CellGroupData[{
Cell[19147, 494, 102, 1, 43, "Subsection"],
Cell[19252, 497, 126, 1, 30, "Text"],
Cell[19381, 500, 3518, 89, 234, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22936, 594, 100, 1, 43, "Subsection"],
Cell[23039, 597, 116, 1, 30, "Text"],
Cell[23158, 600, 3726, 93, 234, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26933, 699, 103, 1, 65, "Chapter"],
Cell[27039, 702, 194, 4, 30, "Text"],
Cell[27236, 708, 19410, 481, 2587, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

